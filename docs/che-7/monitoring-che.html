<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=",  ">
<title>Monitoring Che | Eclipse Che Documentation</title>
<link rel="stylesheet" href="/che/docs/css/syntax.css">
<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="/che/docs/css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="/che/docs/css/customstyles.css">
<link rel="stylesheet" href="/che/docs/css/boxshadowproperties.css">
<!-- most color styles are extracted out to here -->
<link rel="stylesheet" href="/che/docs/css/theme-che.css">


    <link rel="stylesheet" href="/che/docs/css/coderay.css" media="screen" type="text/css">
    <link rel="stylesheet" href="/che/docs/css/asciidoc.css" type="text/css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js" crossorigin="anonymous"></script>
<script src="/che/docs/js/jquery.navgoco.min.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js" crossorigin="anonymous"></script>
<script src="/che/docs/js/toc.js"></script>
<script src="/che/docs/js/customscripts.js"></script>

<link rel="shortcut icon" href="/che/docs/images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="che" href="/feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> Eclipse Che Documentation</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li>
                <!-- entries without drop-downs appear here -->




                
                
                
                <li><a href="https://medium.com/eclipse-che-blog/" target="_blank">Blog</a></li>
                
                
                
                <li><a href="https://github.com/eclipse/che" target="_blank">Source Code</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Che Version<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="/che/docs/che-6/index.html">Che 6</a></li>
                        
                        
                        
                        <li><a href="/che/docs/che-7/index.html">Che 7 Beta</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Get Support<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="https://github.com/eclipse/che/issues?q=is%3Aissue+is%3Aopen+sort%3Aupdated-desc+label%3Akind%2Fbug" target="_blank">Known Bugs</a></li>
                        
                        
                        
                        <li><a href="https://github.com/eclipse/che/issues/new" target="_blank">File an Issue</a></li>
                        
                        
                        
                        <li><a href="https://stackoverflow.com/questions/tagged/eclipse-che" target="_blank">Che on StackOverflow</a></li>
                        
                        
                    </ul>
                </li>
                
                
                <!-- 
			<li>



  <a class="email" title="Submit feedback" href="#" onclick="javascript:window.location='mailto:?subject= feedback&body=I have some feedback about the Monitoring Che page: ' + window.location.href;"><i class="fa fa-envelope-o"></i> Feedback</a>

</li>
 -->
		
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="/che/docs/js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: "/che/docs/search.json",
                                searchResultTemplate: '<li><a href="{url}" title="Monitoring Che">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                

<ul id="mysidebar" class="nav">
  <li class="sidebarTitle"> </li>
  
  
  
  <li>
      <a href="#">Overview</a>
      <ul>
          
          
          
          <li><a href="introduction-to-eclipse-che.html">Introduction to Che</a></li>
          
          
          
          
          
          
          <li><a href="che-quick-starts.html">Che quick-starts</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">End-user Guide</a>
      <ul>
          
          
          
          <li><a href="using-developer-environments-workspaces.html">Using developer environments - workspaces</a></li>
          
          
          
          
          
          
          <li><a href="extending-che.html">Extending Che</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Administration Guide</a>
      <ul>
          
          
          
          <li><a href="monitoring-che.html">Monitoring Che</a></li>
          
          
          
          
          
          
          <li><a href="tracing-che.html">Tracing Che</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Hands-on Guidance</a>
      <ul>
          
          
          
          <li><a href="contributor-tasks.html">Contributor tasks</a></li>
          
          
          
          
      </ul>
   </li>
     
      
      
      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
         -->
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>

            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            <div class="post-header">
   <h1 class="post-title-main">Monitoring Che</h1>
</div>



<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.
$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2' });
/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top
  $(window).scrollTop(scroll_target - 10);
  return false
})

});
</script>

<div id="toc"></div>

    


    <!-- 


     -->

  <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Che can expose certain data as metrics, that can be processed by Prometheus and Grafana stack. Prometheus is a monitoring system, that maintains the collection of metrics - time series key-value data which can represent consumption of resources like CPU and memory, amount of processed HTTP queries and their execution time, and Che specific resources, such as number of users and workspaces, the start and shutdown of workspaces, information about JsonRPC stack.</p>
</div>
<div class="paragraph">
<p>Prometheus is powered with a special query language, that allows manipulating the collected data, and perform various binary, vector and aggregation operations with it, to help create a more refined view on data.</p>
</div>
<div class="paragraph">
<p>While Prometheus is the central piece, responsible for scraping and storing the metrics, while Grafana offers a front-end "facade" with tools to create a various visual representation in the form of dashboards with various panels and graph types.</p>
</div>
<div class="paragraph">
<p>Note that this monitoring stack is not an official production-ready solution, but rather has an introduction purpose.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="../images/monitoring/monitoring-che-stack-structure.png"><img src="../images/monitoring/monitoring-che-stack-structure.png" alt="monitoring che stack structure"></a>
</div>
<div class="title">Figure 1. The structure of Che monitoring stack</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="enabling-che-metrics-collections">Enabling Che metrics collections</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="prerequisites-monitoring-che">Prerequisites</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Installed Prometheus 2.9.1 or above. See more <a href="https://prometheus.io/docs/introduction/first_steps/">https://prometheus.io/docs/introduction/first_steps/</a>.</p>
</li>
<li>
<p>Installed Grafana 6.0 or above. See more at <a href="https://grafana.com/docs/installation/">https://grafana.com/docs/installation/</a></p>
</li>
</ul>
</div>
<h2 id="procedure" class="discrete">Procedure</h2>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the <code>CHE_METRICS_ENABLED=true</code> environment variable</p>
</li>
<li>
<p>Expose the <code>8087</code> port as a service on the che-master host</p>
</li>
<li>
<p>Configure Prometheus to scrape metrics from the <code>8087</code> port</p>
</li>
<li>
<p>Configure a Prometheus data source on Grafana</p>
</li>
<li>
<p>Deploy Che-specific dashboards on Grafana</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="collecting-che-metrics-with-prometheus_monitoring-che">Collecting Che metrics with Prometheus</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Prometheus is a monitoring system that collects metrics in real time and stores them in a time series database.</p>
</div>
<div class="paragraph">
<p>Prometheus comes with a console accessible at the <code>9090</code> port of the application pod. By default, a template provides an existing <strong>service</strong> and a <strong>route</strong> to access it. It can be used to query and view metrics.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="../images/monitoring/monitoring-che-prometheus-console.png"><img src="../images/monitoring/monitoring-che-prometheus-console.png" alt="monitoring che prometheus console"></a>
</div>
</div>
<div class="sect2">
<h3 id="prometheus-terminology">Prometheus terminology</h3>
<div class="paragraph">
<p>Prometheus offers:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">counter</dt>
<dd>
<p>the simplest numerical type of metric whose value can be only increased. A typical example is counting the amount of HTTP requests that go through the system.</p>
</dd>
<dt class="hdlist1">gauge</dt>
<dd>
<p>numerical value that can be increased or decreased. Best suited for representing values of objects.</p>
</dd>
<dt class="hdlist1">histogram</dt>
<dd>
<p>a more complex metric that is suited for performing observations. Metrics are collected and grouped in configurable buckets, which allwos to present the results, for instance, in a form of a heatmap.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="configuring-prometheus">Configuring Prometheus</h3>
<div class="listingblock">
<div class="title">Prometheus configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">- <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">apiVersion: v1</span></span>
  <span style="color:#606">data</span>:
    <span style="color:#606">prometheus.yml</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">|-</span><span style="color:#D20">
      global:
        scrape_interval:     5s           <i class="conum" data-value="1"></i><b>(1)</b>
        evaluation_interval: 5s           <i class="conum" data-value="2"></i><b>(2)</b>
      scrape_configs:
        - job_name: 'che'
          static_configs:
            - targets: ['che-host:8087']</span></span>
  <span style="color:#606">kind</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">ConfigMap</span></span>
  <span style="color:#606">metadata</span>:
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">prometheus-config</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>rate, at which a target is scraped</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>rate, at which recording and alerting rules are re-checked (not used in our system at the moment)</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="viewing-che-metrics-on-grafana-dashboards_monitoring-che">Viewing Che metrics on Grafana dashboards</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Grafana is used for informative representation of Prometheus metrics. Providing visibility for Openshift, Grafanaâ€™s deployment configuration and ConfigMaps are located in the <code>che-monitoring.yaml</code> configuration file.</p>
</div>
<div class="sect2">
<h3 id="configuring-and-deploying-grafana">Configuring and deploying Grafana</h3>
<div class="paragraph">
<p>Grafana is run on port <code>3000</code> with a corresponding <strong>service</strong> and <strong>route</strong>.</p>
</div>
<div class="paragraph">
<p>Two ConfigMaps are used to configure Grafana:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>grafana-datasources</code>&#8201;&#8212;&#8201;configuration for Grafana datasource, a Prometheus endpoint</p>
</li>
<li>
<p><code>grafana-dashboards</code>&#8201;&#8212;&#8201;configuration of Grafana dashboards and panels</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="grafana-dashboards-overview">Grafana dashboards overview</h3>
<div class="paragraph">
<p>Che provides several types of dashboards.</p>
</div>
<div class="sect3">
<h4 id="che-server-dashboard">Che server dashboard</h4>
<div class="paragraph">
<p>Use case: Che server-specific metrics related to Che components, such as workspaces or users.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/monitoring/monitoring-che-che-server-dashboard-general-panel.png" alt="monitoring che che server dashboard general panel">
</div>
<div class="title">Figure 2. The <strong>General</strong> panel</div>
</div>
<div class="paragraph">
<p>The <strong>General</strong> panel contains basic information, such as the total number of users and workspaces in the Che database.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="../images/monitoring/monitoring-che-che-server-dashboard-workspace-panel.png"><img src="../images/monitoring/monitoring-che-che-server-dashboard-workspace-panel.png" alt="monitoring che che server dashboard workspace panel"></a>
</div>
<div class="title">Figure 3. The <strong>Workspaces</strong> panel</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Workspace start rate</strong>&#8201;&#8212;&#8201;the ratio between successful and failed started workspaces</p>
</li>
<li>
<p><strong>Workspace stop rate</strong>&#8201;&#8212;&#8201;the ratio between successful and failed stopped workspaces</p>
</li>
<li>
<p><strong>Workspace Failures</strong>&#8201;&#8212;&#8201;the number of workspace failures shown on the graph</p>
</li>
<li>
<p><strong>Starting Workspaces</strong>&#8201;&#8212;&#8201;the gauge that shows the number of currently starting workspaces</p>
</li>
<li>
<p><strong>Running Workspace</strong>&#8201;&#8212;&#8201;the gauge that shows the number of currently running workspaces</p>
</li>
<li>
<p><strong>Average Workspace Start Time</strong>&#8201;&#8212;&#8201;5-minute average of workspace starts or fails</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="../images/monitoring/monitoring-che-che-server-dashboard-requests-panel.png"><img src="../images/monitoring/monitoring-che-che-server-dashboard-requests-panel.png" alt="monitoring che che server dashboard requests panel"></a>
</div>
<div class="title">Figure 4. The <strong>Request</strong> panel</div>
</div>
<div class="paragraph">
<p>The <strong>Requests</strong> panel displays HTTP requests in a graph that shows the average number of requests per minute.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="../images/monitoring/monitoring-che-che-server-dashboard-jsonrpc-panel.png"><img src="../images/monitoring/monitoring-che-che-server-dashboard-jsonrpc-panel.png" alt="monitoring che che server dashboard jsonrpc panel"></a>
</div>
<div class="title">Figure 5. The <strong>JsonRPC</strong> panel</div>
</div>
<div class="paragraph">
<p>The <strong>JsonRPC</strong> panel show how the JsonRPC stack is used for sending asynchronous messages between the Che server and clients (for example, the GWT IDE).</p>
</div>
<div class="paragraph">
<p>There are two endpoints - major and minor. The major endpoint is the primary endpoint. It is used for sending important messages, such as workspace statuses. The minor endpoint is typically used by workspace starting logs.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>JsonRpcQueue</strong>&#8201;&#8212;&#8201;the number of queued tasks on executors</p>
</li>
<li>
<p><strong>Rejected message/minute</strong>&#8201;&#8212;&#8201;the number of messages that will be rejected if executors and queue are full</p>
</li>
<li>
<p><strong>Seconds Max</strong>&#8201;&#8212;&#8201;the maximum time of executing a task through the JsonRPC stack in the given moment of time</p>
</li>
<li>
<p><strong>Seconds Sum</strong>&#8201;&#8212;&#8201;the summary time of executing a task through the JsonRPC stack in the given moment of time</p>
</li>
<li>
<p><strong>Completed Task/minute</strong>&#8201;&#8212;&#8201;the number of completed tasks per minute</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="../images/monitoring/monitoring-che-che-server-dashboard-workspace-detailed-panel.png"><img src="../images/monitoring/monitoring-che-che-server-dashboard-workspace-detailed-panel.png" alt="monitoring che che server dashboard workspace detailed panel"></a>
</div>
<div class="title">Figure 6. The <strong>Workspace detailed</strong> panel</div>
</div>
<div class="paragraph">
<p>The <strong>Workspace Detailed</strong> panel contains heat maps, which illustrate the average time of workspace starts or fails. The row shows some period of time.</p>
</div>
</div>
<div class="sect3">
<h4 id="che-server-jvm-dashboard">Che server JVM dashboard</h4>
<div class="paragraph">
<p>Use case: JVM metrics of the Che server, such as JVM memory or classloading.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="../images/monitoring/monitoring-che-che-server-jvm-dashboard.png"><img src="../images/monitoring/monitoring-che-che-server-jvm-dashboard.png" alt="monitoring che che server jvm dashboard"></a>
</div>
<div class="title">Figure 7. Che server JVM dashboard</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="../images/monitoring/monitoring-che-che-server-jvm-dashboard-quick-facts.png"><img src="../images/monitoring/monitoring-che-che-server-jvm-dashboard-quick-facts.png" alt="monitoring che che server jvm dashboard quick facts"></a>
</div>
<div class="title">Figure 8. Quick Facts</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="../images/monitoring/monitoring-che-che-server-jvm-dashboard-jvm-memory.png"><img src="../images/monitoring/monitoring-che-che-server-jvm-dashboard-jvm-memory.png" alt="monitoring che che server jvm dashboard jvm memory"></a>
</div>
<div class="title">Figure 9. JVM Memory</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="../images/monitoring/monitoring-che-che-server-jvm-dashboard-jvm-misc.png"><img src="../images/monitoring/monitoring-che-che-server-jvm-dashboard-jvm-misc.png" alt="monitoring che che server jvm dashboard jvm misc"></a>
</div>
<div class="title">Figure 10. JVM Misc</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="../images/monitoring/monitoring-che-che-server-jvm-dashboard-jvm-memory-pools-heap.png"><img src="../images/monitoring/monitoring-che-che-server-jvm-dashboard-jvm-memory-pools-heap.png" alt="monitoring che che server jvm dashboard jvm memory pools heap"></a>
</div>
<div class="title">Figure 11. JVM Memory Pools (heap)</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="../images/monitoring/monitoring-che-che-server-jvm-dashboard-jvm-memory-pools-non-heap.png"><img src="../images/monitoring/monitoring-che-che-server-jvm-dashboard-jvm-memory-pools-non-heap.png" alt="monitoring che che server jvm dashboard jvm memory pools non heap"></a>
</div>
<div class="title">Figure 12. JVM Memory Pools (Non-Heap)</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="../images/monitoring/monitoring-che-che-server-jvm-dashboard-garbage-collection.png"><img src="../images/monitoring/monitoring-che-che-server-jvm-dashboard-garbage-collection.png" alt="monitoring che che server jvm dashboard garbage collection"></a>
</div>
<div class="title">Figure 13. Garbage Collection</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="../images/monitoring/monitoring-che-che-server-jvm-dashboard-classloading.png"><img src="../images/monitoring/monitoring-che-che-server-jvm-dashboard-classloading.png" alt="monitoring che che server jvm dashboard classloading"></a>
</div>
<div class="title">Figure 14. Classloading</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="../images/monitoring/monitoring-che-che-server-jvm-dashboard-buffer-pools.png"><img src="../images/monitoring/monitoring-che-che-server-jvm-dashboard-buffer-pools.png" alt="monitoring che che server jvm dashboard buffer pools"></a>
</div>
<div class="title">Figure 15. Buffer Pools</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="developing-grafana-dashboards_monitoring-che">Developing Grafana dashboards</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Grafana offers the possibility to add custom panels.</p>
</div>
<h3 id="procedure-2" class="discrete">Procedure</h3>
<div class="paragraph">
<p>To add a custom panel, use the <strong>New dashboard</strong> view.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the first section, define <strong>Queries to</strong>. Use the <em>Prometheus Query Language</em> to construct a specific metric, as well as to modify it with various aggregation operators.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="../images/monitoring/monitoring-che-new-grafana-dashboard-queries.png"><img src="../images/monitoring/monitoring-che-new-grafana-dashboard-queries.png" alt="monitoring che new grafana dashboard queries"></a>
</div>
<div class="title">Figure 16. New Grafana dashboard: Queries to</div>
</div>
</li>
<li>
<p>In the <strong>Visualisation</strong> section, choose a metric to be shown in the following visual in the form of a graph, gauge, heatmap, or others.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="../images/monitoring/monitoring-che-new-grafana-dashboard-visualization.png"><img src="../images/monitoring/monitoring-che-new-grafana-dashboard-visualization.png" alt="monitoring che new grafana dashboard visualization"></a>
</div>
<div class="title">Figure 17. New Grafana dashboard: Visualization</div>
</div>
</li>
<li>
<p>Save changes to the dashboard by clicking the <b class="button">Save</b> button, and copy and paste the JSON code to the deployment.</p>
</li>
<li>
<p>Load changes in the configuration of a running Grafana deployment. First remove the deployment:</p>
<div class="listingblock">
<div class="content">
<pre>$ oc process -f che-monitoring.yaml | oc delete -f -</pre>
</div>
</div>
<div class="paragraph">
<p>Then redeploy your Grafana with the new configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ oc process -f che-monitoring.yaml | oc apply -f - | oc rollout latest grafana</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="extending-che-monitoring-metrics_monitoring-che">Extending Che monitoring metrics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two major modules for metrics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>che-core-metrics-core</code>&#8201;&#8212;&#8201;contains core metrics module</p>
</li>
<li>
<p><code>che-core-api-metrics</code>&#8201;&#8212;&#8201;contains metrics that are dependent on core Che components, such as workspace or user managers</p>
</li>
</ul>
</div>
<h3 id="procedure-3" class="discrete">Procedure</h3>
<div class="paragraph">
<p>To create a metric or a group of metrics, you need a class that extends the <code>MeterBinder</code> class. This allows to register the created metric in the overriden <code>bindTo(MeterRegistry registry)</code> method.</p>
</div>
<div class="paragraph">
<p>The following is an example of a metric that has a function that supplies the value for it:</p>
</div>
<div class="listingblock">
<div class="title">Example metric</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">UserMeterBinder</span> <span style="color:#088;font-weight:bold">implements</span> MeterBinder {

  <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> UserManager userManager;

  <span style="color:#007">@Inject</span>
  <span style="color:#088;font-weight:bold">public</span> UserMeterBinder(UserManager userManager) {
    <span style="color:#950">this</span>.userManager = userManager;
  }

  <span style="color:#007">@Override</span>
  <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> bindTo(MeterRegistry registry) {
    Gauge.builder(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">che.user.total</span><span style="color:#710">&quot;</span></span>, <span style="color:#950">this</span>::count)
        .description(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Total amount of users</span><span style="color:#710">&quot;</span></span>)
        .register(registry);
  }

  <span style="color:#088;font-weight:bold">private</span> <span style="color:#339;font-weight:bold">double</span> count() {
    <span style="color:#080;font-weight:bold">try</span> {
      <span style="color:#080;font-weight:bold">return</span> userManager.getTotalCount();
    } <span style="color:#080;font-weight:bold">catch</span> (<span style="color:#C00;font-weight:bold">ServerException</span> e) {
      <span style="color:#080;font-weight:bold">return</span> <span style="color:#0a8;font-weight:bold">Double</span>.NaN;
    }
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, the metric can be stored with a reference and updated manually in some other place in the code.</p>
</div>
<h3 id="additional-resources" class="discrete">Additional resources</h3>
<div class="paragraph">
<p>For more information about the types of metrics and naming conventions, visit Prometheus documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://prometheus.io/docs/practices/naming/">Naming practices</a></p>
</li>
<li>
<p><a href="https://prometheus.io/docs/concepts/metric_types/">Metric types</a></p>
</li>
</ul>
</div>
</div>
</div>

    <div class="tags">
        
        <b>Tags: </b>
        
        
        
    </div>

<!-- 
 -->

</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
                    Eclipse Che - Documentation <br/>
                    Site last generated: Jun 12, 2019 <br/>
                    <hr>
                    <a href="http://www.eclipse.org" target="_blank">Eclipse Foundation</a><br/>
                    <a href="http://www.eclipse.org/legal/privacy.php" target="_blank">Privacy Policy</a><br/>
                    <a href="http://www.eclipse.org/legal/termsofuse.php" target="_blank">Terms of Use</a><br/>
                    <a href="https://www.eclipse.org/legal/epl-2.0/" target="_blank">Eclipse Public License</a><br/>
                    <a href="http://www.eclipse.org/legal" target="_blank">Legal Resources</a><br/>
                </div>
            </div>
</footer>




    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>
